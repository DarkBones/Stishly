$(document).on('turbolinks:load', ()=> {

  if ($(".datepicker").length > 0){
    $.ajax({
      type: "GET",
      dataType: "text",
      url: "/api/week_start",
      success: function(data) {
        $('.datepicker').datepicker({
          format: 'dd-M-yyyy',
          todayHighlight: true,
          weekStart: parseInt(data),
          autoclose: true
        });
      },
      error: function(request, status, error) {
        $('.datepicker').datepicker({
          format: 'dd-M-yyyy',
          todayHighlight: true,
          autoclose: true
        });
      }
    });
    
    $('.datepicker').each(function(){
      if (!$(this).hasClass('datepicker-null')){
        $(this).attr({'value': getDate});
      }
    });

    $('input[type="time"][value="now"]').each(function(){
      $(this).attr({'value': getTime});
    });
  }

});

function getDate() {
  var dt = new Date(),
      h = dt.getHours(),
      m = dt.getMinutes();
      d = dt.getDate();
      mm = dt.getMonth();
      y = dt.getYear() + 1900;
  if(h < 10) h = '0' + h;
  if(m < 10) m = '0' + m;
  if(d < 10) d = '0' + d;

  var month = new Array();
  month[0] = "Jan";
  month[1] = "Feb";
  month[2] = "Mar";
  month[3] = "Apr";
  month[4] = "May";
  month[5] = "Jun";
  month[6] = "Jul";
  month[7] = "Aug";
  month[8] = "Sep";
  month[9] = "Oct";
  month[10] = "Nov";
  month[11] = "Dec";

  return d + '-' + month[mm] + '-' + y;
}

function getTime() {
  var dt = new Date(),
      h = dt.getHours(),
      m = dt.getMinutes();
      d = dt.getDate();
      mm = dt.getMonth();
      y = dt.getYear() + 1900;
  if(h < 10) h = '0' + h;
  if(m < 10) m = '0' + m;
  if(d < 10) d = '0' + d;

  return h + ':' + m;
}