<% 
  type ||= ""
  suff = ""
  if defined?(id)
    suff = "_#{id}"
  end
%>

<% if type != "income" %>
  <div id="simple_schedule_form<%= suff %>" class="ladderform simple_schedule_form">
    <% if type != "fixed_expense" %>
      <div class="py-2">
        <input type="text" class="form-control py-2" placeholder="Schedule name" name="name<%= suff %>">
      </div>
    <% else %>
      <select name="category<%= suff %>" class="form-control">
        <option disabled selected value> -- </option>
        <option value="rent" children=".path-schedule">Rent</option>
        <option value="mortgage" children=".path-schedule">Mortgage</option>
        <option value="electricity" children=".path-schedule">Electricity</option>
        <option value="water" children=".path-schedule">Water</option>
        <option value="vehicle" children=".path-schedule">Car loan</option>
        <option value="vehicle_insurance" children=".path-schedule">Car Insurance</option>
        <option value="health_insurance" children=".path-schedule">Health Insurance</option>
        <option value="house_insurance" children=".path-schedule">Property Insurance</option>
        <option value="phone" children=".path-schedule">Phone</option>
        <option value="internet" children=".path-schedule">Internet</option>
        <option value="subscription" children=".path-schedule">Subscriptions</option>
        <option value="tv" children=".path-schedule">Cable</option>
        <option value="lending" children=".path-schedule">Debt payments</option>
        <option value="other" children=".path-schedule, .path-other-category">Other ...</option>
      </select>

      <div class="children py-2">
        <div class="hidden path-other-category">
          <input type="text" name="category_name" class="form-control" placeholder="Fixed expense name">
        </div>

        <div class="hidden path-schedule py-2">

    <% end %>
<% end %>

<p>every</p>
<input type="number" class="form-control pos_n" id="periodNum<%= suff %>" value="1" step="1" name="periodNum<%= suff %>">
<select name="period<%= suff %>" class="form-control">
  <option value="months" children=".path-months, .path-amount">months</option>
  <option value="weeks" children=".path-weeks, .path-amount">weeks</option>
  <option value="days" children=".path-days, .path-amount">days</option>
</select>

<div class="children">
  <div class="path-months">
    <p>on the</p>
    <select name="month_day<%= suff %>" class="form-control" id="month_day<%= suff %>">
      <option value="1">first</option>
      <option value="last">last</option>
      <option value="2">2nd</option>
      <option value="3">3rd</option>
      <option value="4">4th</option>
      <option value="5">5th</option>
      <option value="6">6th</option>
      <option value="7">7th</option>
      <option value="8">8th</option>
      <option value="9">9th</option>
      <option value="10">10th</option>
      <option value="11">11th</option>
      <option value="12">12th</option>
      <option value="13">13th</option>
      <option value="14">14th</option>
      <option value="15">15th</option>
      <option value="16">16th</option>
      <option value="17">17th</option>
      <option value="18">18th</option>
      <option value="19">19th</option>
      <option value="20">20th</option>
      <option value="21">21st</option>
      <option value="22">22nd</option>
      <option value="23">23rd</option>
      <option value="24">24th</option>
      <option value="25">25th</option>
      <option value="26">26th</option>
      <option value="27">27th</option>
      <option value="28">28th</option>
    </select>
    <select name="month_day2<%= suff %>" class="form-control" id="month_day2<%= suff %>">
      <option disabled selected value> -- </option>
      <option value="day" children=".path-months-except-wday, .path-amount">day</option>
      <option value="sun" children="">Sunday</option>
      <option value="mon" children="">Monday</option>
      <option value="tue" children="">Tuesday</option>
      <option value="wed" children="">Wednesday</option>
      <option value="thu" children="">Thursday</option>
      <option value="fri" children="">Friday</option>
      <option value="sat" children="">Saturday</option>
    </select>

    <div class="children">
      <div class="hidden path-months-except-wday">
        <select name="month_exclude_wday<%= suff %>" class="form-control">
          <option value="none" children=".path-amount">without exceptions</option>
          <option value="weekends" children=".path-months-except-met, .path-amount">except on weekends</option>
          <option value="except-sun" children=".path-months-except-met, .path-amount">except on Sundays</option>
          <option value="except-mon" children=".path-months-except-met, .path-amount">except on Mondays</option>
          <option value="except-tue" children=".path-months-except-met, .path-amount">except on Tuesdays</option>
          <option value="except-wed" children=".path-months-except-met, .path-amount">except on Wednesdays</option>
          <option value="except-thu" children=".path-months-except-met, .path-amount">except on Thursdays</option>
          <option value="except-fri" children=".path-months-except-met, .path-amount">except on Fridays</option>
          <option value="except-sat" children=".path-months-except-met, .path-amount">except on Saturdays</option>
        </select>

        <div class="children py-2">
          <div class="hidden path-months-except-met">
            <p>, then <%= type == "income" ? "I get paid" : "run" %> on the</p>
            <select name="month_exclude_met<%= suff %>" class="form-control">
              <option value="previous">previous</option>
              <option value="next">next</option>
            </select>
            <select name="month_exclude_met_day<%= suff %>" class="form-control">
              <option value="sun">Sunday</option>
              <option value="mon">Monday</option>
              <option value="tue">Tuesday</option>
              <option value="wed">Wednesday</option>
              <option value="thu">Thursday</option>
              <option value="fri">Friday</option>
              <option value="sat">Saturday</option>
            </select>
          </div>
        </div>

      </div>
    </div>

  </div>

  <div class="hidden path-weeks">
    <p>on</p>
    <select name="week_day<%= suff %>" class="form-control">
      <option disabled selected value> -- </option>
      <option value="sun">Sunday</option>
      <option value="mon">Monday</option>
      <option value="tue">Tuesday</option>
      <option value="wed">Wednesday</option>
      <option value="thu">Thursday</option>
      <option value="fri">Friday</option>
      <option value="sat">Saturday</option>
    </select>
  </div>
  <div class="hidden path-days">
    <p>starting on</p>
    <input name="day_date<%= suff %>" class="form-control datepicker">
  </div>

  <% if type == "income" || type == "fixed_expense" %>
    <div class="path-amount py-2">
      <select name="fixed_amount<%= suff %>" class="form-control">
        <option value="fixed" children=".path-fixed-amount">Fixed amount</option>
        <option value="varied" children=".path-varied-amount">the amount varies</option>
      </select>

      <div class="children py-2">
        <div class="path-fixed-amount">
          <%= select_tag "currency", options_for_select(all_currencies(Money::Currency.table), :selected => current_user.currency), {:class => "form-control"} %>
          <input type="number" step="any" class="form-control" placeholder="amount" name="amount<%= suff %>"><br />
          <%= select_tag "account#{suff}", options_for_select(user_accounts_array),{:class => "form-control account_select my-2"} %>
        </div>
        <div class="hidden path-varied-amount">
          <%= select_tag "currency#{suff}", options_for_select(all_currencies(Money::Currency.table), :selected => current_user.currency), {:class => "form-control"} %>
          <input type="number" step="any" class="form-control" placeholder="Average amount" name="average_amount<%= suff %>"><br />
          <%= select_tag "account_average#{suff}", options_for_select(user_accounts_array),{:class => "form-control account_select my-2"} %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% if type != "income" %>
  </div>
<% end %>

<% if type == "fixed_expense" %>
    </div>
  </div>
<% end %>

<script>
  $("[id^=month_day]").change(function(){
    let n = parseInt($(this).val());
    if (Number.isNaN(n)) {
      n = 1
    }

    if (n > 4) {
      $(this).next().val("day");
      $(this).next().find("option").slice(2).attr("disabled", "disabled");
      showHideFields($(this).next());
    } else {
      $(this).next().find("option").slice(2).removeAttr('disabled');
      showHideFields($(this).next());
    }
  });
</script>