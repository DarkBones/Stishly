<% currency = active_account.id == 0 ? current_user.currency : active_account.currency %>
<% amount = active_account.id == 0 ? transaction.user_currency_amount : transaction.account_currency_amount %>
<% amount = balance(amount.to_f, Money::Currency.new(currency), "cents") %>

<% conversion_message = nil %>
<%
  if transaction.currency != currency
    conversion_message = balance(transaction.amount, Money::Currency.new(transaction.currency), "cents")
  end
  %>

<div class="transaction-checkbox float-left">

  <%#= check_box_tag("delete[#{transaction.id}]",1, class: 'checkbox-inline') %>
  <%= check_box_tag "select[#{transaction.id}]", transaction.id, false, class: 'checkbox-inline', 'onchange' => 'selectTransaction(this);'%>

</div>

<div class="transaction-details">

  <% if transaction.children.length > 0 %>
    <span class="show-child-transactions float-left clickable">
      <%= image_tag 'arrow_right_line_white.svg' %>
    </span>
  <% end %>


  <a href="<%= transactions_path + "/" + transaction.id.to_s %>" class="text-light">
    <li time="<%= transaction.time_num %>" id="transaction_<%= transaction.id %>">

      <%= image_tag "categories/" + transaction.category.symbol + ".svg",
        :style => "background-color: hsl(" + transaction.category.color + ");",
        :class => "rounded-circle",
        "height" => "50" %>

      <%= transaction.description %>
      <span class="balance float-right">
        <%= amount %>
      </span>
      <span class="float-right conversion-message">
        <%= "~" if conversion_message %>
        <%= conversion_message %>
      </span>

      <br />
      <span class="transfer-message">
        <%= transaction.transfer_message %>
      </span>

    </li>
  </a>

  <% if transaction.children.length > 0 %>
    <ul class="child_transactions list-unstyled">
      <% transaction.children.decorate.each do |ct| %>
        <% child_currency = Money::Currency.new(ct.currency) %>
        <li>
          <%= ct.description %>
          <span class="balance float-right">
            <%= balance(ct.amount.to_f, child_currency, "cents") %>
          </span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <hr />

</div>
